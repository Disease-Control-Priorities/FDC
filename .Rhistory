left_join(., locs)%>%
filter(year==2019)%>%
select(year, location, sex=Sex, htn=Prevalence.of.hypertension)%>%
mutate(sex=ifelse(sex=="Men", "Male", "Female"))
#PIN, age 55-79
load("output2.Rda")
load("output_aspirin2.Rda")
pop<-output%>%filter(age>=55 & age<80, intervention %in% c("Scenario 3", "Scenario 4"))%>%
group_by(sex, year, location, intervention)%>%
summarise(pop= sum(pop)/4,
cvd = sum(sick))%>%
mutate(regimen = "No aspirin")%>%bind_rows(., output2%>%
filter(age>=55 & age<80, intervention %in% c("Scenario 3", "Scenario 4"))%>%
group_by(sex, year, location, intervention)%>%
summarise(pop= sum(pop)/4,
cvd = sum(sick))%>%
mutate(regimen = "Aspirin"))
rm(output)
rm(output2)
rm(data.in)
#PP adverse effects
adv<-left_join(pop, htn)
#PP adverse effects
adv<-left_join(pop, htn)%>%
left_join(., inc)
rm(list=ls())
setwd(dirname(rstudioapi::getActiveDocumentContext()$path))
pacman::p_load(data.table, dplyr, tidyr, ggplot2, RColorBrewer)
#coverage, events
inc<-read.csv("scale-up-new-aspirin.csv", stringsAsFactors = F)%>%
mutate(regimen="Aspirin")%>%bind_rows(.,read.csv("scale-up-new.csv", stringsAsFactors = F)%>%
mutate(regimen="No aspirin"))
locs<-read.csv("coverage_data/Country_groupings_extended.csv", stringsAsFactors = F)%>%
select(gbd2019, iso3, wb2021, location_gbd, location_ncdrisc)%>%rename(location = gbd2019)
htn<-read.csv("coverage_data/NCD-RisC_Lancet_2021_Hypertension_crude_countries.csv", stringsAsFactors = F)%>%
rename(iso3 = ISO, year=Year)%>%
left_join(., locs)%>%
filter(year==2019)%>%
select(year, location, sex=Sex, htn=Prevalence.of.hypertension)%>%
mutate(sex=ifelse(sex=="Men", "Male", "Female"))
#PIN, age 55-79
load("output2.Rda")
load("output_aspirin2.Rda")
View(inc)
#coverage, events
inc<-read.csv("scale-up-new-aspirin.csv", stringsAsFactors = F)%>%
mutate(regimen="Aspirin")%>%bind_rows(.,read.csv("scale-up-new.csv", stringsAsFactors = F)%>%
mutate(regimen="No aspirin"))%>%
select(location, year, cause, intervention, regimen, pp.cov.inc, sp.cov.inc,
pp.trt.inc, sp.trt.inc)
View(inc)
locs<-read.csv("coverage_data/Country_groupings_extended.csv", stringsAsFactors = F)%>%
select(gbd2019, iso3, wb2021, location_gbd, location_ncdrisc)%>%rename(location = gbd2019)
htn<-read.csv("coverage_data/NCD-RisC_Lancet_2021_Hypertension_crude_countries.csv", stringsAsFactors = F)%>%
rename(iso3 = ISO, year=Year)%>%
left_join(., locs)%>%
filter(year==2019)%>%
select(year, location, sex=Sex, htn=Prevalence.of.hypertension)%>%
mutate(sex=ifelse(sex=="Men", "Male", "Female"))
pop<-output%>%filter(age>=55 & age<80, intervention %in% c("Scenario 3", "Scenario 4"))%>%
group_by(sex, year, location, intervention, cause)%>%
summarise(pop= sum(pop)/4,
cvd = sum(sick))%>%
mutate(regimen = "No aspirin")%>%bind_rows(., output2%>%
filter(age>=55 & age<80, intervention %in% c("Scenario 3", "Scenario 4"))%>%
group_by(sex, year, location, intervention)%>%
summarise(pop= sum(pop)/4,
cvd = sum(sick))%>%
mutate(regimen = "Aspirin"))
View(inc)
#coverage, events
inc<-read.csv("scale-up-new-aspirin.csv", stringsAsFactors = F)%>%
mutate(regimen="Aspirin")%>%bind_rows(.,read.csv("scale-up-new.csv", stringsAsFactors = F)%>%
mutate(regimen="No aspirin"))%>%
select(location, year, cause, intervention, regimen, pp.cov.inc, sp.cov.inc,
pp.trt.inc, sp.trt.inc)%>%
filter(intervention %in% c("Scenario 3", "Scenario 4"))
View(inc)
View(pop)
#PP adverse effects
adv<-left_join(pop, htn)%>%
left_join(., inc)
View(data.in)
View(adv)
htn<-read.csv("coverage_data/NCD-RisC_Lancet_2021_Hypertension_crude_countries.csv", stringsAsFactors = F)%>%
rename(iso3 = ISO, year=Year)%>%
left_join(., locs)%>%
filter(year==2019)%>%
select(location, sex=Sex, htn=Prevalence.of.hypertension)%>%
mutate(sex=ifelse(sex=="Men", "Male", "Female"))
#PP adverse effects
adv<-left_join(pop, htn)%>%
left_join(., inc)%>%
filter(year>=2019)
View(adv)
View(inc)
View(inc)
#coverage, events
inc<-read.csv("scale-up-new-aspirin.csv", stringsAsFactors = F)%>%
mutate(regimen="Aspirin")%>%bind_rows(.,read.csv("scale-up-new.csv", stringsAsFactors = F)%>%
mutate(regimen="No aspirin"))%>%
select(location, year, cause, intervention, regimen, pp.cov.inc, sp.cov.inc,
pp.trt.inc, sp.trt.inc)%>%
filter(intervention %in% c("Scenario 3", "Scenario 4"))
locs<-read.csv("coverage_data/Country_groupings_extended.csv", stringsAsFactors = F)%>%
select(gbd2019, iso3, wb2021, location_gbd, location_ncdrisc)%>%rename(location = gbd2019)
htn<-read.csv("coverage_data/NCD-RisC_Lancet_2021_Hypertension_crude_countries.csv", stringsAsFactors = F)%>%
rename(iso3 = ISO, year=Year)%>%
left_join(., locs)%>%
filter(year==2019)%>%
select(location, sex=Sex, htn=Prevalence.of.hypertension)%>%
mutate(sex=ifelse(sex=="Men", "Male", "Female"))
pop<-output%>%filter(age>=55 & age<80, intervention %in% c("Scenario 3", "Scenario 4"))%>%
group_by(sex, year, location, intervention, cause)%>%
summarise(pop= sum(pop)/4,
cvd = sum(sick))%>%
mutate(regimen = "No aspirin")%>%bind_rows(., output2%>%
filter(age>=55 & age<80, intervention %in% c("Scenario 3", "Scenario 4"))%>%
group_by(sex, year, location, intervention)%>%
summarise(pop= sum(pop)/4,
cvd = sum(sick))%>%
mutate(regimen = "Aspirin"))
pop<-output%>%filter(age>=55 & age<80, intervention %in% c("Scenario 3", "Scenario 4"))%>%
group_by(sex, year, location, intervention, cause)%>%
summarise(pop= sum(pop),
cvd = sum(sick))%>%
mutate(regimen = "No aspirin")%>%bind_rows(., output2%>%
filter(age>=55 & age<80, intervention %in% c("Scenario 3", "Scenario 4"))%>%
group_by(sex, year, location, intervention)%>%
summarise(pop= sum(pop)/4,
cvd = sum(sick))%>%
mutate(regimen = "Aspirin"))
#PP adverse effects
adv<-left_join(pop, htn)%>%
left_join(., inc)%>%
filter(year>=2019)
View(adv)
View(inc)
#PP adverse effects
adv<-left_join(pop, htn)%>%
left_join(., inc)%>%
filter(year>=2019)%>%
group_by(year, sex, location, intervention, regimen)%>%
summarise(pop = mean(pop, na.rm = T),
pp_trt = mean(pp.trt.inc))%>%
mutate(dizzy = pop*htn*pp_trt*0.025,
gi_bleed = pop*htn*pp_trt*0.002)
adv<-left_join(pop, htn)%>%
left_join(., inc)%>%
filter(year>=2019)%>%
group_by(year, sex, location, intervention, regimen)%>%
summarise(pop = mean(pop, na.rm = T),
pp_trt = mean(pp.trt.inc))
#PP adverse effects
adv<-left_join(pop, htn)%>%
left_join(., inc)%>%
filter(year>=2019)%>%
group_by(year, sex, location, intervention, regimen)%>%
summarise(pop = mean(pop, na.rm = T),
pp_trt = mean(pp.trt.inc, na.rm=T))%>%
mutate(dizzy = pop*htn*pp_trt*0.025,
gi_bleed = pop*htn*pp_trt*0.002)
adv<-left_join(pop, htn)%>%
left_join(., inc)%>%
filter(year>=2019)%>%
group_by(year, sex, location, intervention, regimen)%>%
summarise(pop = mean(pop, na.rm = T),
pp_trt = mean(pp.trt.inc, na.rm=T))
View(adv)
#PP adverse effects
adv<-left_join(pop, htn)%>%
left_join(., inc)%>%
filter(year>=2019)%>%
na.omit()%>%
group_by(year, sex, location, intervention, regimen)%>%
summarise(pop = mean(pop, na.rm = T),
pp_trt = mean(pp.trt.inc, na.rm=T))%>%
mutate(dizzy = pop*htn*pp_trt*0.025,
gi_bleed = pop*htn*pp_trt*0.002)
adv<-left_join(pop, htn)%>%
left_join(., inc)%>%
filter(year>=2019)%>%
na.omit()%>%
group_by(year, sex, location, intervention, regimen)%>%
summarise(pop = mean(pop, na.rm = T),
pp_trt = mean(pp.trt.inc, na.rm=T))
View(adv)
#PP adverse effects
adv<-left_join(pop, htn)%>%
left_join(., inc)%>%
filter(year>=2019)%>%
na.omit()%>%
group_by(year, sex, location, intervention, regimen)%>%
summarise(pop = mean(pop, na.rm = T),
pp_trt = mean(pp.trt.inc, na.rm=T),
htn = mean(htn))%>%
mutate(dizzy = pop*htn*pp_trt*0.025,
gi_bleed = pop*htn*pp_trt*0.002)
View(adv)
left_join
#PP adverse effects
adv<-left_join(pop, htn)%>%
left_join(., inc)%>%
filter(year>=2019)%>%
na.omit()%>%
group_by(year, sex, location, intervention, regimen)%>%
summarise(pop = mean(pop, na.rm = T),
pp_trt = mean(pp.trt.inc, na.rm=T),
htn = mean(htn))%>%
mutate(dizzy = pop*htn*pp_trt*0.025,
gi_bleed = pop*htn*pp_trt*0.002)%>%
group_by(intervention, regimen)%>%
summarise(dizzy = sum(dizzy),
gi_bleed = sum(gi_bleed))
View(adv)
#PP adverse effects
adv<-left_join(pop, htn)%>%
left_join(., inc)%>%
filter(year>=2019)%>%
group_by(year, sex, location, intervention, regimen)%>%
summarise(pop = mean(pop, na.rm = T),
pp_trt = mean(pp.trt.inc, na.rm=T),
htn = mean(htn))%>%
mutate(dizzy = pop*htn*pp_trt*0.025,
gi_bleed = pop*htn*pp_trt*0.002)%>%
group_by(intervention, regimen)%>%
summarise(dizzy = sum(dizzy),
gi_bleed = sum(gi_bleed))
View(adv)
adv<-left_join(pop, htn)%>%
left_join(., inc)%>%
filter(year>=2019)%>%
group_by(year, sex, location, intervention, regimen)%>%
summarise(pop = mean(pop, na.rm = T),
pp_trt = mean(pp.trt.inc, na.rm=T),
htn = mean(htn))
View(adv)
inc<-read.csv("scale-up-new-aspirin.csv", stringsAsFactors = F)%>%
mutate(regimen="Aspirin")%>%bind_rows(.,read.csv("scale-up-new.csv", stringsAsFactors = F)%>%
mutate(regimen="No aspirin"))
View(inc)
any(is.na(inc))
#coverage, events
inc<-read.csv("scale-up-new-aspirin.csv", stringsAsFactors = F)%>%
mutate(regimen="Aspirin")%>%bind_rows(.,read.csv("scale-up-new.csv", stringsAsFactors = F)%>%
mutate(regimen="No aspirin"))%>%
select(location, year, cause, intervention, regimen, pp.cov.inc, sp.cov.inc,
pp.trt.inc, sp.trt.inc)%>%
filter(intervention %in% c("Scenario 3", "Scenario 4"))
any(is.na(inc))
View(inc)
pop<-output%>%filter(age>=55 & age<80, intervention %in% c("Scenario 3", "Scenario 4"))%>%
group_by(sex, year, location, intervention, cause)%>%
summarise(pop= sum(pop),
cvd = sum(sick))%>%
mutate(regimen = "No aspirin")%>%bind_rows(., output2%>%
filter(age>=55 & age<80, intervention %in% c("Scenario 3", "Scenario 4"))%>%
group_by(sex, year, location, intervention)%>%
summarise(pop= sum(pop)/4,
cvd = sum(sick))%>%
mutate(regimen = "Aspirin"))
View(pop)
pop<-output%>%filter(age>=55 & age<80, intervention %in% c("Scenario 3", "Scenario 4"))%>%
group_by(sex, year, location, intervention, cause)%>%
summarise(pop= sum(pop),
cvd = sum(sick))%>%
mutate(regimen = "No aspirin")%>%bind_rows(., output2%>%
filter(age>=55 & age<80, intervention %in% c("Scenario 3", "Scenario 4"))%>%
group_by(sex, year, location, intervention)%>%
summarise(pop= sum(pop)/4,
cvd = sum(sick))%>%
mutate(regimen = "Aspirin"))%>%
na.omit()
View(pop)
#PP adverse effects
adv<-left_join(pop, htn)%>%
left_join(., inc)%>%
filter(year>=2019)%>%
group_by(year, sex, location, intervention, regimen)%>%
summarise(pop = mean(pop, na.rm = T),
pp_trt = mean(pp.trt.inc, na.rm=T),
htn = mean(htn))%>%
mutate(dizzy = pop*htn*pp_trt*0.025,
gi_bleed = pop*htn*pp_trt*0.002)%>%
group_by(intervention, regimen)%>%
summarise(dizzy = sum(dizzy),
gi_bleed = sum(gi_bleed))
View(adv)
adv<-left_join(pop, htn)%>%
left_join(., inc)%>%
filter(year>=2019)%>%
group_by(year, sex, location, intervention, regimen)%>%
summarise(pop = mean(pop, na.rm = T),
pp_trt = mean(pp.trt.inc, na.rm=T),
htn = mean(htn))
View(adv)
View(pop)
pop<-output%>%filter(age>=55 & age<80, intervention %in% c("Scenario 3", "Scenario 4"))%>%
group_by(sex, year, location, intervention, cause)%>%
summarise(pop= sum(pop),
cvd = sum(sick))%>%
mutate(regimen = "No aspirin")%>%bind_rows(., output2%>%
filter(age>=55 & age<80, intervention %in% c("Scenario 3", "Scenario 4"))%>%
group_by(sex, year, location, intervention, cause)%>%
summarise(pop= sum(pop),
cvd = sum(sick))%>%
mutate(regimen = "Aspirin"))%>%
na.omit()
View(htn)
locs<-read.csv("coverage_data/Country_groupings_extended.csv", stringsAsFactors = F)%>%
select(gbd2019, iso3, wb2021, location_gbd, location_ncdrisc)%>%rename(location = location_gbd)
htn<-read.csv("coverage_data/NCD-RisC_Lancet_2021_Hypertension_crude_countries.csv", stringsAsFactors = F)%>%
rename(iso3 = ISO, year=Year)%>%
left_join(., locs)%>%
filter(year==2019)%>%
select(location, sex=Sex, htn=Prevalence.of.hypertension)%>%
mutate(sex=ifelse(sex=="Men", "Male", "Female"))
pop<-output%>%filter(age>=55 & age<80, intervention %in% c("Scenario 3", "Scenario 4"))%>%
group_by(sex, year, location, intervention, cause)%>%
summarise(pop= sum(pop),
cvd = sum(sick))%>%
mutate(regimen = "No aspirin")%>%bind_rows(., output2%>%
filter(age>=55 & age<80, intervention %in% c("Scenario 3", "Scenario 4"))%>%
group_by(sex, year, location, intervention, cause)%>%
summarise(pop= sum(pop),
cvd = sum(sick))%>%
mutate(regimen = "Aspirin"))%>%
na.omit()
#PP adverse effects
adv<-left_join(pop, htn)%>%
left_join(., inc)%>%
filter(year>=2019)%>%
group_by(year, sex, location, intervention, regimen)%>%
summarise(pop = mean(pop, na.rm = T),
pp_trt = mean(pp.trt.inc, na.rm=T),
htn = mean(htn))%>%
mutate(dizzy = pop*htn*pp_trt*0.025,
gi_bleed = pop*htn*pp_trt*0.002)%>%
group_by(intervention, regimen)%>%
summarise(dizzy = sum(dizzy),
gi_bleed = sum(gi_bleed))
View(adv)
#PP adverse effects
adv_pp<-left_join(pop, htn)%>%
left_join(., inc)%>%
filter(year>=2019)%>%
group_by(year, sex, location, intervention, regimen)%>%
summarise(pop = mean(pop, na.rm = T),
pp_trt = mean(pp.trt.inc, na.rm=T),
htn = mean(htn))%>%
mutate(dizzy = pop*htn*pp_trt*0.025,
gi_bleed = pop*htn*pp_trt*0.002)%>%
group_by(intervention, regimen)%>%
summarise(dizzy = sum(dizzy),
gi_bleed = sum(gi_bleed))
#SP adverse effects
adv_sp<-left_join(pop, inc)%>%
filter(year>=2019)%>%
mutate(dizzy = cvd*sp.trt.inc*0.025,
gi_bleed = cvd*sp.trt.inc*0.002)%>%
group_by(intervention, regimen)%>%
summarise(dizzy = sum(dizzy),
gi_bleed = sum(gi_bleed))
View(adv_sp)
View(inc)
#SP adverse effects
adv_sp<-left_join(pop, inc)%>%
filter(year>=2019)%>%
mutate(dizzy = cvd*sp.trt.inc*0.025,
gi_bleed = cvd*sp.trt.inc*0.002)%>%
group_by(intervention, regimen)%>%
summarise(dizzy = sum(dizzy, na.rm = T),
gi_bleed = sum(gi_bleed, na.rm=T))
View(adv_sp)
#PP adverse effects
adv_pp<-left_join(pop, htn)%>%
left_join(., inc)%>%
filter(year>=2019)%>%
group_by(year, sex, location, intervention, regimen)%>%
summarise(pop = mean(pop, na.rm = T),
pp_trt = mean(pp.trt.inc, na.rm=T),
htn = mean(htn))%>%
mutate(dizzy = pop*htn*pp_trt*0.025,
gi_bleed = pop*htn*pp_trt*0.002)%>%
group_by(intervention, regimen)%>%
summarise(dizzy = sum(dizzy),
gi_bleed = sum(gi_bleed))%>%
mutate(treatment = "Primary prevention")
#SP adverse effects
adv_sp<-left_join(pop, inc)%>%
filter(year>=2019)%>%
mutate(dizzy = cvd*sp.trt.inc*0.025,
gi_bleed = cvd*sp.trt.inc*0.002)%>%
group_by(intervention, regimen)%>%
summarise(dizzy = sum(dizzy, na.rm = T),
gi_bleed = sum(gi_bleed, na.rm=T))%>%
mutate(treatment = "Secondary prevention")
View(adv_pp)
write.csv(bind_rows(adv_pp, adv_sp), "adverse_effects.csv", row.names = F)
write.csv(bind_rows(adv_pp, adv_sp)%>%mutate(gi_bleed = ifelse(regimen=="No aspirin", 0, gi_bleed)), "adverse_effects.csv", row.names = F)
rm(list=ls())
#coverage, events
inc<-read.csv("scale-up-new-aspirin.csv", stringsAsFactors = F)%>%
mutate(regimen="Aspirin")%>%bind_rows(.,read.csv("scale-up-new.csv", stringsAsFactors = F)%>%
mutate(regimen="No aspirin"))%>%
select(location, year, cause, intervention, regimen, pp.trt.inc)%>%
filter(intervention %in% c("Scenario 2", "Scenario 3", "Scenario 4"))
View(inc)
View(inc)
#coverage, events
inc<-read.csv("scale-up-new-aspirin.csv", stringsAsFactors = F)%>%
mutate(regimen="Aspirin")%>%bind_rows(.,read.csv("scale-up-new.csv", stringsAsFactors = F)%>%
mutate(regimen="No aspirin"))%>%
select(location, year, cause, intervention, regimen, pp.trt.inc)%>%
filter(intervention %in% c("Scenario 2", "Scenario 3", "Scenario 4"))%>%
spread(intervention, pp.trt.inc)%>%
mutate(A1 = `Scenario 3` - `Scenario 2`,
A2 = `Scenario 3` - `Scenario 2`)
View(inc)
any(is.na(inc))
locs<-read.csv("coverage_data/Country_groupings_extended.csv", stringsAsFactors = F)%>%
select(gbd2019, iso3, wb2021, location_gbd, location_ncdrisc)%>%rename(location = location_gbd)
htn<-read.csv("coverage_data/NCD-RisC_Lancet_2021_Hypertension_crude_countries.csv", stringsAsFactors = F)%>%
rename(iso3 = ISO, year=Year)%>%
left_join(., locs)%>%
filter(year==2019)%>%
select(location, sex=Sex, htn=Prevalence.of.hypertension)%>%
mutate(sex=ifelse(sex=="Men", "Male", "Female"))
#PIN, age 55-79
load("output2.Rda")
load("output_aspirin2.Rda")
pop<-output%>%filter(age>=55 & age<80, intervention %in% c("Scenario 3", "Scenario 4"))%>%
group_by(sex, year, location, intervention)%>%
summarise(pop= sum(pop)/4,
cvd = sum(sick))%>%
mutate(regimen = "No aspirin")%>%bind_rows(., output2%>%
filter(age>=55 & age<80, intervention %in% c("Scenario 3", "Scenario 4"))%>%
group_by(sex, year, location, intervention)%>%
summarise(pop= sum(pop)/4,
cvd = sum(sick))%>%
mutate(regimen = "Aspirin"))%>%
na.omit()
View(pop)
rm(data.in)
rm(output)
rm(output2)
#coverage, events
inc<-read.csv("scale-up-new-aspirin.csv", stringsAsFactors = F)%>%
mutate(regimen="Aspirin")%>%bind_rows(.,read.csv("scale-up-new.csv", stringsAsFactors = F)%>%
mutate(regimen="No aspirin"))%>%
select(location, year, cause, intervention, regimen, pp.trt.inc)%>%
filter(intervention %in% c("Scenario 2", "Scenario 3", "Scenario 4"))%>%
group_by(location, year, intervention, regimen)%>%
summarise(pp.trt.inc = mean(pp.trt.inc, na.rm = T))%>%
spread(intervention, pp.trt.inc)%>%
mutate(A1 = `Scenario 3` - `Scenario 2`,
A2 = `Scenario 3` - `Scenario 2`)
View(inc)
any(is.na(inc))
#coverage, events
inc<-read.csv("scale-up-new-aspirin.csv", stringsAsFactors = F)%>%
mutate(regimen="Aspirin")%>%bind_rows(.,read.csv("scale-up-new.csv", stringsAsFactors = F)%>%
mutate(regimen="No aspirin"))%>%
select(location, year, cause, intervention, regimen, pp.trt.inc)%>%
filter(intervention %in% c("Scenario 2", "Scenario 3", "Scenario 4"))%>%
group_by(location, year, intervention, regimen)%>%
summarise(pp.trt.inc = mean(pp.trt.inc, na.rm = T))%>%
spread(intervention, pp.trt.inc)%>%
mutate(A1 = `Scenario 3` - `Scenario 2`,
A2 = `Scenario 3` - `Scenario 2`)%>%
select(-`Scenario 2`, -`Scenario 3`, -`Scenario 4`)%>%
gather(intervention, cov)
#coverage, events
inc<-read.csv("scale-up-new-aspirin.csv", stringsAsFactors = F)%>%
mutate(regimen="Aspirin")%>%bind_rows(.,read.csv("scale-up-new.csv", stringsAsFactors = F)%>%
mutate(regimen="No aspirin"))%>%
select(location, year, cause, intervention, regimen, pp.trt.inc)%>%
filter(intervention %in% c("Scenario 2", "Scenario 3", "Scenario 4"))%>%
group_by(location, year, intervention, regimen)%>%
summarise(pp.trt.inc = mean(pp.trt.inc, na.rm = T))%>%
spread(intervention, pp.trt.inc)%>%
mutate(A1 = `Scenario 3` - `Scenario 2`,
A2 = `Scenario 3` - `Scenario 2`)%>%
select(-`Scenario 2`, -`Scenario 3`, -`Scenario 4`)%>%
gather(intervention, cov, -location, -year, -regimen)
View(inc)
#coverage, events
inc<-read.csv("scale-up-new-aspirin.csv", stringsAsFactors = F)%>%
mutate(regimen="Aspirin")%>%bind_rows(.,read.csv("scale-up-new.csv", stringsAsFactors = F)%>%
mutate(regimen="No aspirin"))%>%
select(location, year, cause, intervention, regimen, pp.trt.inc)%>%
filter(intervention %in% c("Scenario 2", "Scenario 3", "Scenario 4"))%>%
group_by(location, year, intervention, regimen)%>%
summarise(pp.trt.inc = mean(pp.trt.inc, na.rm = T))%>%
spread(intervention, pp.trt.inc)%>%
mutate(`Scenario 3` = `Scenario 3` - `Scenario 2`,
`Scenario 4` = `Scenario 4` - `Scenario 2`)%>%
select(-`Scenario 2`)%>%
gather(intervention, cov, -location, -year, -regimen)
any(is.na(inc))
View(inc)
#PP adverse effects
adv_pp<-left_join(pop, inc)%>%
mutate(no_cvd = pop-cvd)%>%
filter(year>=2019)%>%
mutate(dizzy = no_cvd*cov*0.025,
gi_bleed = no_cvd*cov*0.002)%>%
group_by(intervention, regimen)%>%
summarise(dizzy = sum(dizzy),
gi_bleed = sum(gi_bleed))
View(adv_pp)
write.csv(adv_pp%>%mutate(gi_bleed = ifelse(regimen=="No aspirin", 0, gi_bleed)), "adverse_effects.csv", row.names = F)
